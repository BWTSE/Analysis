---
title: "SonarQube Issues"
output: html_notebook
---

Sonarqube issues:

Descriptive statistics:

```{r}
d.both_completed %>%
  ggplot(aes(x=sonarqube_issues, fill=high_debt_version)) + 
  geom_boxplot()

mean(d.both_completed$sonarqube_issues)
var(d.both_completed$sonarqube_issues)
```

Super basic:

```{r}
sonarqube_issues0 <- brm(
  sonarqube_issues ~ 1 + (1 |c| session),
  family = negbinomial(),
  data = as.data.frame(d.both_completed),
  prior = c(
    prior(normal(1.5, 1), class = "Intercept"),
    prior(gamma(0.01,0.01), class = "shape")
  ),
  control = list(adapt_delta = 0.95),
  #empty = TRUE
  file = "fits/sonarqube_issues0",
  file_refit = "on_change"
)

```

Adding debt level as predictor:

```{r}
sonarqube_issues1.with <- extendable_model(
  base_name = "sonarqube_issues1",
  base_formula = "sonarqube_issues ~ 1 + high_debt_version + (1 | c | session)",
  base_priors = c(
    prior(normal(0, 1), class = "b"),
    prior(normal(1.5, 1), class = "Intercept"),
    prior(exponential(1), class = "sd"),
    prior(gamma(0.01, 0.01), class = "shape")
  ),
  family = negbinomial(),
  data = d.both_completed,
  base_control = list(adapt_delta = 0.95)
)


sonarqube_issues1 <- sonarqube_issues1.with()
summary(sonarqube_issues1)
```

Compare

```{r}
loo(sonarqube_issues0, sonarqube_issues1.with())

```


```{r}
summary(sonarqube_issues1.with("work_domain"))
```

```{r}
summary(sonarqube_issues1.with("work_experience_programming.s"))
```


```{r}
summary(sonarqube_issues1.with("work_experience_java.s"))
```

```{r}
summary(sonarqube_issues1.with("education_field"))
```

```{r}
summary(sonarqube_issues1.with(
  "mo(education_level)", 
  c(
    prior(dirichlet(2), class = "simo", coef = "moeducation_level1")
  )
))
```

```{r}
summary(sonarqube_issues1.with("workplace_peer_review"))
```

```{r}
summary(sonarqube_issues1.with("workplace_td_tracking"))
```

```{r}
summary(sonarqube_issues1.with("workplace_pair_programming"))
```

```{r}
summary(sonarqube_issues1.with("workplace_coding_standards"))
```

```{r}
summary(sonarqube_issues1.with("scenario"))
```

```{r}
summary(sonarqube_issues1.with("group"))
```
```{r}
summary(
  sonarqube_issues1.with(
  c("work_domain", 
    "work_experience_programming.s",
    "work_experience_java.s",
    "education_field",
    "mo(education_level)",
    "workplace_peer_review",
    "workplace_td_tracking",
    "workplace_pair_programming",
    "workplace_coding_standards",
    "scenario",
    "group"
    ),
  c(
    prior(dirichlet(2), class = "simo", coef = "moeducation_level1")
    )
  )
)

pp_check(
  sonarqube_issues1.with(
  c("work_domain", 
    "work_experience_programming.s",
    "work_experience_java.s",
    "education_field",
    "mo(education_level)",
    "workplace_peer_review",
    "workplace_td_tracking",
    "workplace_pair_programming",
    "workplace_coding_standards",
    "scenario",
    "group"
    ),
  c(
    prior(dirichlet(2), class = "simo", coef = "moeducation_level1")
    )
  ),
  type = "bars",
  nsamples = "100"
)

```

```{r}

loo(
  sonarqube_issues1.with(),
  sonarqube_issues1.with("work_domain"),
  sonarqube_issues1.with("work_experience_programming.s"),
  sonarqube_issues1.with("work_experience_java.s"),
  sonarqube_issues1.with("education_field"),
  sonarqube_issues1.with(
  "mo(education_level)", 
  c(
    prior(dirichlet(2), class = "simo", coef = "moeducation_level1")
  )
  ),
  sonarqube_issues1.with("workplace_peer_review"),
  sonarqube_issues1.with("workplace_td_tracking"),
  sonarqube_issues1.with("workplace_pair_programming"),
  sonarqube_issues1.with("workplace_coding_standards"),
  sonarqube_issues1.with("scenario"),
  sonarqube_issues1.with("group"),
  sonarqube_issues1.with(c("scenario","group")),
  sonarqube_issues1.with(
  c("work_domain", 
    "work_experience_programming.s",
    "work_experience_java.s",
    "education_field",
    "mo(education_level)",
    "workplace_peer_review",
    "workplace_td_tracking",
    "workplace_pair_programming",
    "workplace_coding_standards",
    "scenario",
    "group"
    ),
  c(
    prior(dirichlet(2), class = "simo", coef = "moeducation_level1")
    )
)
)
```



Candidate models:
```{r}
sonarqube_issues_cand1 <- sonarqube_issues1.with()
summary(sonarqube_issues_cand1)
ranef(sonarqube_issues_cand1)
plot(sonarqube_issues_cand1)
pp_check(sonarqube_issues_cand1, type = "bars", nsamples = 100)

```

```{r}

sonarqube_issues_cand2 <- sonarqube_issues1.with("scenario")
summary(sonarqube_issues_cand2)
ranef(sonarqube_issues_cand2)
plot(sonarqube_issues_cand2)
pp_check(sonarqube_issues_cand2, type = "bars", nsamples = 100)

```

```{r}
sonarqube_issues_cand3 <- sonarqube_issues1.with("group")
summary(sonarqube_issues_cand3)
ranef(sonarqube_issues_cand3)
plot(sonarqube_issues_cand3)
pp_check(sonarqube_issues_cand3, type = "bars", nsamples = 100)

```

```{r}

sonarqube_issues_cand4 <- sonarqube_issues1.with(c("group","scenario"))
summary(sonarqube_issues_cand4)
ranef(sonarqube_issues_cand4)
plot(sonarqube_issues_cand4)
pp_check(sonarqube_issues_cand4, type = "bars", nsamples = 100)

```

```{r}
loo(sonarqube_issues_cand1,sonarqube_issues_cand2,sonarqube_issues_cand3,sonarqube_issues_cand4)

```